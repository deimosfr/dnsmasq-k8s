[supervisord]
nodaemon=true
user=root

[program:dnsmasq]
# Use 'exec' to ensure dnsmasq runs as the main process
command=/bin/sh -c "sleep 5 && exec /usr/sbin/dnsmasq -k --dhcp-leasefile=\"${DHCP_LEASE_FILE:-/var/lib/misc/dnsmasq.leases}\""
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20

[program:dnsmasq-k8s]
command=/dnsmasq-k8s
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10
